<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Schoah</title>
  <style>
    @font-face {
      font-family: 'Katarine';
      src: url('https://file.garden/Z3HtEpAjyGTEZiXW/katarine.woff') format('woff');
    }
    body {
      font-family: 'Katarine', Arial, sans-serif;
      background: #f2f2f2;
      text-align: center;
      padding: 50px;
      overflow-x: hidden;
      overflow-y: auto;
      margin: 0;
      transition: all 0.5s;
      color: #000;
    }
    #disclaimer {
      font-size: 14px;
      color: #ff0000;
      margin-bottom: 20px;
    }
    #logo {
      width: 200px;
      height: auto;
      margin-bottom: 20px;
    }
    #results {
      text-align: left;
      margin-top: 20px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      color: #444;
    }
    .result {
      margin-bottom: 15px;
    }
    .result a {
      font-size: 18px;
      font-weight: bold;
      text-decoration: none;
      color: #1a0dab;
    }
    .result p {
      margin: 5px 0 0;
      color: #444;
    }
  </style>
</head>
<body>
  <div id="disclaimer">⚠️ Schoah is in beta and will break at any time.</div>

  <img id="logo" src="./logo.png" alt="Schoah Logo" />

  <div>
    <input type="text" id="query" placeholder="Search DuckDuckGo or YouTube ID..." />
    <button onclick="search()">Search</button>
  </div>

  <div id="results"></div>

  <script>
    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    function search() {
      var query = document.getElementById('query').value.trim();
      var resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '';

      if (!query) {
        resultsDiv.textContent = 'Please enter a search query.';
        return;
      }

      // YouTube ID embed
      var ytIDpattern = /^[a-zA-Z0-9_-]{11}$/;
      if (ytIDpattern.test(query)) {
        var iframe = document.createElement('iframe');
        iframe.width = "560";
        iframe.height = "315";
        iframe.src = "https://www.youtube.com/embed/" + query;
        iframe.title = "YouTube video player";
        iframe.frameBorder = "0";
        iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
        iframe.allowFullscreen = true;
        resultsDiv.appendChild(iframe);
        return;
      }

      // DuckDuckGo search API
      var url = 'https://api.duckduckgo.com/?q=' + encodeURIComponent(query) + '&format=json&no_html=1';

      var xhr = new XMLHttpRequest();
      xhr.open('GET', url, true);

      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            var data = JSON.parse(xhr.responseText);

            if (data.AbstractText) {
              var abstractDiv = document.createElement('div');
              abstractDiv.className = 'result';
              abstractDiv.innerHTML =
                '<h3>' + data.Heading + '</h3>' +
                '<p>' + data.AbstractText + '</p>' +
                '<a href="' + data.AbstractURL + '" target="_blank" rel="noopener noreferrer">' + data.AbstractURL + '</a>';
              resultsDiv.appendChild(abstractDiv);
            }

            if (data.RelatedTopics && data.RelatedTopics.length > 0) {
              var count = 0;
              for (var i = 0; i < data.RelatedTopics.length; i++) {
                var item = data.RelatedTopics[i];
                if (item.Topics && item.Topics.length > 0) {
                  for (var j = 0; j < item.Topics.length; j++) {
                    if (count >= 10) break;
                    addResult(item.Topics[j], resultsDiv);
                    count++;
                  }
                } else if (item.Text && item.FirstURL) {
                  if (count >= 10) break;
                  addResult(item, resultsDiv);
                  count++;
                }
              }
            }

            if (!data.AbstractText && (!data.RelatedTopics || data.RelatedTopics.length === 0)) {
              resultsDiv.textContent = 'No results found.';
            }
          } else {
            resultsDiv.textContent = 'Error fetching results.';
          }
        }
      };

      xhr.send();
    }

    function addResult(item, container) {
      var div = document.createElement('div');
      div.className = 'result';
      div.innerHTML =
        '<a href="' + item.FirstURL + '" target="_blank" rel="noopener noreferrer">' + item.Text + '</a>';
      container.appendChild(div);
    }

    // On load: if q is empty or missing, redirect to root; else run search
    window.addEventListener('DOMContentLoaded', function () {
      var q = getQueryParam('q');
      if (q === null || q.trim() === '') {
        // Redirect to root (page without query parameters)
        if (window.location.search.length > 0) {
          window.location.href = window.location.pathname;
        }
      } else {
        document.getElementById('query').value = q;
        search();
      }
    });
  </script>
</body>
</html>
